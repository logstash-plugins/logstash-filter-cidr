input {
  generator {
    count => 200000
    lines => [
      "192.168.1.100",
      "123.123.123.123",
      "foobar",
      "fe80::1234"
    ]
    threads => 1
  }
}

filter {
  cidr {
    ipeventfield => true
    address => [ "message" ]
    netusesprintf => false
    network => [ "123.0.0.0/8" ]
    add_tag => [ "remote" ]
  }


  cidr {
    ipeventfield => true
    address => [ "message" ]
    netusesprintf => false
    network => [ "127.0.0.1/8", "::1/128", "fe80::/64", "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16" ]
    add_tag => [ "local" ]
  }

  if ("local" in [tags]){
    metrics { meter => "local" add_tag => "metric" }
  } else if ("remote" in [tags]){
    metrics { meter => "remote" add_tag => "metric" }
  } else {
    metrics { meter => "not_an_ip" add_tag => "metric" }
  }

}


output {
  if ("metric" in [tags] ) {
    stdout {
      codec => rubydebug
    }
  }
}

